<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Metadata Microservice</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>File Metadata Microservice</h1>
            <p class="subtitle">Upload a file to view its metadata information</p>
        </header>
        
        <div class="content">
            <div class="card">
                <h2><i class="fas fa-info-circle"></i> About This Service</h2>
                <p>This service allows you to upload files and retrieve their metadata including name, type, and size. It's a solution for the FreeCodeCamp Back End Development and APIs certification project.</p>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-upload"></i> Upload a File</h2>
                
                <form id="uploadForm" enctype="multipart/form-data">
                    <div class="upload-area" id="dropArea">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <p class="upload-text">Drag & drop your file here or click to browse</p>
                        <label for="upfile" class="browse-btn">Select File</label>
                        <input type="file" id="upfile" name="upfile" class="file-input" required>
                    </div>
                    
                    <div class="file-info" id="fileInfo">
                        <h3><i class="fas fa-file"></i> Selected File</h3>
                        <div class="file-details">
                            <span class="file-detail-label">Name:</span>
                            <span id="fileName">-</span>
                            
                            <span class="file-detail-label">Type:</span>
                            <span id="fileType">-</span>
                            
                            <span class="file-detail-label">Size:</span>
                            <span id="fileSize">-</span>
                        </div>
                    </div>
                    
                    <button type="submit" class="submit-btn" id="submitBtn" disabled>Get File Metadata</button>
                </form>
                
                <div class="output" id="output">
// Metadata will appear here after upload...
// Example response:
// {
//   "name": "example.txt",
//   "type": "text/plain",
//   "size": 1234
// }
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-road"></i> API Usage</h2>
                <p>Use this endpoint to get file metadata:</p>
                
                <div class="examples">
                    <div class="example">
                        <h3><i class="fas fa-upload"></i> Upload Endpoint</h3>
                        <div class="endpoint">POST /api/fileanalyse</div>
                        <p>Upload a file using multipart/form-data with the field name "upfile" to get its metadata.</p>
                    </div>
                    
                    <div class="example">
                        <h3><i class="fas fa-desktop"></i> Example Response</h3>
                        <div class="example-response">{
  "name": "example.txt",
  "type": "text/plain",
  "size": 1234
}</div>
                    </div>
                    
                    <div class="example">
                        <h3><i class="fas fa-code"></i> How to Use</h3>
                        <div class="endpoint">Usage</div>
                        <p>You can use curl, JavaScript fetch, or a form submission to upload a file and receive its metadata in JSON format.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>&copy; 2025, Nabeel Yassine. All Rights Reserved.</p>
            <p>Developed as part of the FreeCodeCamp Back End Development and APIs Certification</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const upfileInput = document.getElementById('upfile');
            const dropArea = document.getElementById('dropArea');
            const fileInfo = document.getElementById('fileInfo');
            const fileName = document.getElementById('fileName');
            const fileType = document.getElementById('fileType');
            const fileSize = document.getElementById('fileSize');
            const submitBtn = document.getElementById('submitBtn');
            const output = document.getElementById('output');
            const uploadForm = document.getElementById('uploadForm');
            
            // Drag and drop functionality
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropArea.classList.add('dragover');
            }
            
            function unhighlight() {
                dropArea.classList.remove('dragover');
            }
            
            dropArea.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length) {
                    upfileInput.files = files;
                    handleFiles(files);
                }
            }
            
            dropArea.addEventListener('click', () => {
                upfileInput.click();
            });
            
            upfileInput.addEventListener('change', function() {
                handleFiles(this.files);
            });
            
            function handleFiles(files) {
                if (files.length) {
                    const file = files[0];
                    
                    // Display file information
                    fileName.textContent = file.name;
                    fileType.textContent = file.type || 'unknown';
                    fileSize.textContent = formatFileSize(file.size);
                    
                    fileInfo.style.display = 'block';
                    submitBtn.disabled = false;
                }
            }
            
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            // Form submission
            uploadForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData();
                formData.append('upfile', upfileInput.files[0]);
                
                try {
                    output.textContent = "Uploading file...";
                    submitBtn.disabled = true;
                    
                    const response = await fetch('/api/fileanalyse', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const data = await response.json();
                    
                    if (data.error) {
                        output.innerHTML = `<span class="error">Error: ${data.error}</span>`;
                    } else {
                        output.innerHTML = `<span class="success">File metadata retrieved successfully!</span>\n\n${JSON.stringify(data, null, 2)}`;
                    }
                } catch (error) {
                    output.innerHTML = `<span class="error">Network Error: Could not connect to the API</span>`;
                } finally {
                    submitBtn.disabled = false;
                }
            });
        });
    </script>
</body>
</html>